<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a1428">
    <meta name="screen-orientation" content="landscape">
    <title>实况足球手机版 - 球员抽卡模拟器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0a1428 0%, #1e3c72 50%, #2a5298 100%);
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
            color: #fff;
            overflow-x: hidden;
            position: fixed;
            width: 100vw;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
        }

        /* 移动端横屏提示 - 只在手机竖屏时显示 */
        @media screen and (orientation: portrait) and (max-width: 768px) {
            .orientation-notice {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.95);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                color: white;
                text-align: center;
                padding: 20px;
            }
            
            .orientation-notice .rotate-icon {
                font-size: 80px;
                margin-bottom: 20px;
                animation: rotate 2s infinite linear;
            }
            
            /* 竖屏时隐藏主界面 */
            .top-bar, .container {
                display: none;
            }
        }

        /* 桌面端和横屏时隐藏横屏提示 */
        @media screen and (min-width: 769px), 
               screen and (orientation: landscape) {
            .orientation-notice {
                display: none !important;
            }
        }

        /* CSS动画定义 */
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* 移动端触摸优化 */
        button, .pool-card, .player-card {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        /* 隐藏滚动条但保持滚动功能 */
        .container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .container::-webkit-scrollbar {
            display: none;
        }

        /* 移动端横屏优化 */
        @media screen and (orientation: landscape) and (max-height: 600px) {
            .top-bar {
                padding: 5px 15px;
                font-size: 14px;
            }
            
            .logo {
                font-size: 18px;
            }
            
            .container {
                padding: 10px;
                max-width: none;
                height: calc(100vh - 60px);
                height: calc(var(--vh, 1vh) * 100 - 60px);
                overflow-y: auto;
                overflow-x: hidden;
            }
            
            .hero-section {
                margin-bottom: 20px;
            }
            
            .hero-title {
                font-size: 24px;
            }
            
            .hero-subtitle {
                font-size: 12px;
            }
            
            .pools-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 15px;
            }
            
            .pool-card {
                min-height: 200px;
            }
            
            .pool-title {
                font-size: 16px;
                margin-bottom: 8px;
            }
            
            .pool-subtitle {
                font-size: 12px;
            }
            
            .gacha-controls {
                padding: 15px;
            }
            
            .gacha-button {
                padding: 8px 16px;
                font-size: 14px;
                margin: 5px;
                min-width: 100px;
            }
        }

        /* 顶部导航栏 */
        .top-bar {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #00d4ff;
        }

        .currency-display {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .currency-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex-direction: column;
            text-align: center;
        }

        .currency-item small {
            font-size: 10px;
            opacity: 0.8;
        }

        .coin-icon {
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #ffd700, #ffb300);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: #8b4513;
        }

        /* 主容器 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            height: calc(100vh - 60px);
            height: calc(var(--vh, 1vh) * 100 - 60px);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .hero-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .hero-title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .hero-subtitle {
            font-size: 18px;
            color: #b0c4de;
            margin-bottom: 30px;
        }

        /* 抽卡按钮区域 */
        .gacha-buttons {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 40px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .pool-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pool-section h3 {
            color: #00d4ff;
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .pool-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .pity-counter {
            text-align: center;
            margin-top: 15px;
            color: #ffd700;
            font-size: 14px;
            font-weight: bold;
        }

        .gacha-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }

        .gacha-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .gacha-btn.highlight-pool {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .gacha-btn.featured-pool {
            background: linear-gradient(135deg, #ffd700, #ffb300);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            color: #333;
        }

        .gacha-btn.highlight-normal {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.3);
        }

        .gacha-btn.featured-normal {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            box-shadow: 0 4px 15px rgba(168, 237, 234, 0.3);
            color: #333;
        }

        .gacha-btn.inventory-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .gacha-btn.release-btn {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        }

        .star-rating {
            font-size: 14px;
            margin-top: 10px;
        }

        .new-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff4757;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 1s infinite;
        }

        .pity-badge {
            position: absolute;
            top: 45px;
            right: 10px;
            background: #ffd700;
            color: #333;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            animation: pity-glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes pity-glow {
            from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .card-buttons {
            padding: 10px;
            text-align: center;
        }

        .card-buttons .release-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .card-buttons .release-btn:hover {
            background: #ff3838;
            transform: scale(1.05);
        }

        /* 球员卡片容器 */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        /* 球员卡片 */
        .player-card {
            width: 280px;
            height: 400px;
            margin: 0 auto;
            perspective: 1000px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .player-card:hover {
            transform: translateY(-5px) scale(1.02);
            filter: brightness(1.1);
            cursor: pointer;
        }

        .player-card:hover .click-hint-small {
            animation: clickPulse 0.5s ease-in-out infinite;
            background: rgba(255, 255, 255, 0.2);
            color: #ffd700;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-back {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transform: rotateY(180deg);
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* 神秘卡片背面样式 */
        .mystery-card-back {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            overflow: hidden;
        }

        .mystery-content {
            text-align: center;
            z-index: 2;
            position: relative;
        }

        .pes-logo {
            font-size: 48px;
            margin-bottom: 10px;
            animation: logoFloat 2s ease-in-out infinite;
        }

        .mystery-content h3 {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .mystery-content p {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin: 5px 0;
        }

        .click-hint {
            margin-top: 20px;
            animation: clickPulse 1.5s ease-in-out infinite;
        }

        .click-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .click-hint p {
            font-size: 14px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .click-hint-small {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            background: rgba(0, 0, 0, 0.3);
            padding: 4px 8px;
            border-radius: 10px;
            animation: clickPulse 2s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes clickPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        /* 稀有度样式 - 更新为新的卡池系统 */
        .normal-card { 
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
            color: #333; 
            border: 2px solid #6c757d;
        }
        .dream-featured { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            border: 2px solid #764ba2;
            box-shadow: 0 0 20px rgba(118, 75, 162, 0.5);
        }
        .featured { 
            background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%); 
            color: #333; 
            border: 2px solid #ff8f00;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        .highlight { 
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); 
            border: 2px solid #ff4757;
            box-shadow: 0 0 25px rgba(255, 107, 107, 0.7);
            animation: highlight-glow 2s ease-in-out infinite alternate;
        }
        .legend-highlight { 
            background: linear-gradient(135deg, #8b00ff 0%, #4b0082 100%); 
            border: 2px solid #9400d3;
            box-shadow: 0 0 30px rgba(139, 0, 255, 0.8);
            animation: legend-glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes highlight-glow {
            from { box-shadow: 0 0 25px rgba(255, 107, 107, 0.7); }
            to { box-shadow: 0 0 35px rgba(255, 107, 107, 0.9); }
        }

        @keyframes legend-glow {
            from { box-shadow: 0 0 30px rgba(139, 0, 255, 0.8); }
            to { box-shadow: 0 0 40px rgba(139, 0, 255, 1.0); }
        }

        .card-header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            text-align: center;
        }

        .rarity-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .player-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-overall {
            font-size: 36px;
            font-weight: 900;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .card-body {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }

        .player-info {
            text-align: center;
        }

        .player-position {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .player-club {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-nationality {
            font-size: 14px;
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
        }

        /* 结果显示区域 */
        .result-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .result-title {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            color: #00d4ff;
        }

        /* 动画效果 */
        @keyframes cardFlip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(-90deg); }
            100% { transform: rotateY(0deg); }
        }

        .flip-animation {
            animation: cardFlip 1s ease-in-out;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 50%;
            animation: sparkle 1.5s infinite;
        }

        /* 充值界面样式 */
        .recharge-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .recharge-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .recharge-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .recharge-title {
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .recharge-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: scale(1.2);
            color: #ff6b6b;
        }

        .recharge-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .recharge-option {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .recharge-option:hover {
            transform: translateY(-5px);
            border-color: #ffd700;
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }

        .recharge-option.highlight-directed {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.3), rgba(238, 90, 82, 0.3));
        }

        .recharge-option.featured-directed {
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 179, 0, 0.3));
        }

        .recharge-option.highlight-normal {
            border-color: #ff9500;
            background: linear-gradient(135deg, rgba(255, 149, 0, 0.3), rgba(255, 123, 0, 0.3));
        }

        .recharge-option.featured-normal {
            border-color: #4facfe;
            background: linear-gradient(135deg, rgba(79, 172, 254, 0.3), rgba(0, 242, 254, 0.3));
        }

        .recharge-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .recharge-name {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
        }

        .recharge-price {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .recharge-quantity {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .purchase-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .purchase-btn:hover {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(116, 185, 255, 0.4);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 24px;
            }

            .pool-buttons {
                flex-direction: column;
                align-items: center;
            }

            .gacha-btn {
                width: 200px;
                margin: 5px 0;
            }

            .cards-container {
                grid-template-columns: 1fr;
            }

            .player-card {
                width: 100%;
                max-width: 300px;
            }

            .pool-section {
                padding: 15px;
                margin: 10px;
            }

            .pool-section h3 {
                font-size: 16px;
            }

            .currency-display {
                flex-wrap: wrap;
                gap: 10px;
            }

            .currency-item {
                min-width: 80px;
            }
        }

        /* 抽卡动画系统 */
        .gacha-animation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            background: #000;
            display: none;
            overflow: hidden;
        }

        .stadium-container {
            position: absolute;
            width: 100%;
            height: 100%;
            perspective: 2000px;
            transform-style: preserve-3d;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .stadium {
            position: relative;
            width: 1000px;
            height: 600px;
            background: 
                radial-gradient(ellipse at center, #2d5016 0%, #1a3009 40%, #0f1d05 80%, #000 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 200px rgba(45, 80, 22, 0.8),
                inset 0 0 400px rgba(0, 0, 0, 0.6),
                0 50px 100px rgba(0, 0, 0, 0.8);
            animation: stadiumZoom 3s ease-out forwards;
            transform-origin: center center;
            overflow: hidden;
        }

        @keyframes stadiumZoom {
            0% { 
                transform: rotateX(85deg) scale(0.03) translateZ(-600px); 
                opacity: 0;
                filter: blur(25px);
            }
            20% { 
                transform: rotateX(80deg) scale(0.15) translateZ(-400px); 
                opacity: 0.2;
                filter: blur(18px);
            }
            40% { 
                transform: rotateX(70deg) scale(0.4) translateZ(-250px); 
                opacity: 0.5;
                filter: blur(12px);
            }
            65% { 
                transform: rotateX(55deg) scale(0.7) translateZ(-100px); 
                opacity: 0.75;
                filter: blur(6px);
            }
            85% { 
                transform: rotateX(40deg) scale(0.9) translateZ(-20px); 
                opacity: 0.9;
                filter: blur(2px);
            }
            100% { 
                transform: rotateX(35deg) scale(1) translateZ(0px); 
                opacity: 1;
                filter: blur(0px);
            }
        }

        /* 新增动画：体育场震动效果 */
        @keyframes stadiumVibration {
            0%, 100% { transform: rotateX(35deg) scale(1) translateZ(0px); }
            25% { transform: rotateX(35deg) scale(1.002) translateZ(2px) translateX(1px); }
            50% { transform: rotateX(35deg) scale(1.001) translateZ(-1px) translateX(-1px); }
            75% { transform: rotateX(35deg) scale(1.003) translateZ(1px) translateX(0.5px); }
        }

        /* 新增动画：相机推进效果 */
        @keyframes cameraZoomIn {
            0% { transform: rotateX(35deg) scale(1) translateZ(0px); }
            100% { transform: rotateX(30deg) scale(1.1) translateZ(20px); }
        }

        /* 新增动画：粒子飘散效果 */
        @keyframes cheerParticle {
            0% { 
                opacity: 1; 
                transform: translateY(0) translateX(0) scale(1); 
            }
            50% { 
                opacity: 0.7; 
                transform: translateY(-30px) translateX(var(--random-x, 0)) scale(1.2); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(-60px) translateX(var(--random-x, 0)) scale(0.8); 
            }
        }

        /* 新增动画：环境光脉冲 */
        @keyframes ambientPulse {
            0%, 100% { opacity: 0.3; filter: blur(10px); }
            50% { opacity: 0.6; filter: blur(15px); }
        }

        .stadium-field {
            position: absolute;
            width: 70%;
            height: 85%;
            left: 15%;
            top: 7.5%;
            background: 
                linear-gradient(90deg, 
                    #2d5016 0%, #3d6b1f 10%, #2d5016 20%, 
                    #3d6b1f 30%, #2d5016 40%, #3d6b1f 50%,
                    #2d5016 60%, #3d6b1f 70%, #2d5016 80%,
                    #3d6b1f 90%, #2d5016 100%);
            border-radius: 20px;
            border: 4px solid #ffffff;
            box-shadow: 
                inset 0 0 50px rgba(255, 255, 255, 0.1),
                0 0 30px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        /* 足球场标线 */
        .field-lines {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .center-circle {
            position: absolute;
            width: 80px;
            height: 80px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }

        .penalty-area {
            position: absolute;
            width: 60px;
            height: 120px;
            border: 2px solid rgba(255, 255, 255, 0.6);
            top: 50%;
            transform: translateY(-50%);
        }

        .penalty-area.left { left: 0; }
        .penalty-area.right { right: 0; }

        .stadium-lights {
            position: absolute;
            width: 120%;
            height: 120%;
            left: -10%;
            top: -10%;
            border-radius: 50%;
            z-index: 2;
        }

        .light-strip {
            position: absolute;
            border-radius: 4px;
            opacity: 0;
            animation: lightPulse 0.8s ease-in-out forwards;
            box-shadow: 0 0 30px currentColor;
        }

        .light-strip.top { 
            top: 5%; 
            left: 10%;
            right: 10%;
            height: 8px;
        }
        .light-strip.bottom { 
            bottom: 5%; 
            left: 10%;
            right: 10%;
            height: 8px;
        }
        .light-strip.left { 
            left: 5%; 
            top: 10%;
            bottom: 10%;
            width: 8px;
        }
        .light-strip.right { 
            right: 5%; 
            top: 10%;
            bottom: 10%;
            width: 8px;
        }

        @keyframes lightPulse {
            0% { 
                opacity: 0; 
                transform: scale(0.2);
                filter: blur(10px);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.5);
                filter: blur(0px);
            }
            100% { 
                opacity: 0.9; 
                transform: scale(1);
                filter: blur(0px);
            }
        }

        /* 更华丽的稀有度颜色 */
        .rarity-normal { 
            background: linear-gradient(45deg, #6c757d, #adb5bd, #6c757d);
            background-size: 200% 200%;
            animation: normalGlow 2s ease-in-out infinite;
        }
        .rarity-dream { 
            background: linear-gradient(45deg, #667eea, #764ba2, #a8e6cf, #667eea);
            background-size: 300% 300%;
            animation: dreamGlow 2s ease-in-out infinite;
        }
        .rarity-featured { 
            background: linear-gradient(45deg, #ffd700, #ffb300, #fff700, #ffd700);
            background-size: 300% 300%;
            animation: featuredGlow 2s ease-in-out infinite;
        }
        .rarity-highlight { 
            background: linear-gradient(45deg, #ff6b6b, #ee5a52, #ff9ff3, #ff6b6b);
            background-size: 300% 300%;
            animation: highlightGlow 2s ease-in-out infinite;
        }
        .rarity-legend { 
            background: linear-gradient(45deg, #8b00ff, #4b0082, #da70d6, #8b00ff);
            background-size: 300% 300%;
            animation: legendGlow 2s ease-in-out infinite;
        }
        .rarity-galaxy { 
            background: linear-gradient(45deg, 
                #ff0080, #ff8c00, #ffd700, #00ff80, #00bfff, #8a2be2, #ff1493, #ff0080);
            background-size: 800% 800%;
            animation: galaxyFlow 1s ease-in-out infinite;
            box-shadow: 0 0 50px currentColor;
        }

        @keyframes normalGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes dreamGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes featuredGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes highlightGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes legendGlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes galaxyFlow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 50% 100%; }
            75% { background-position: 0% 50%; }
        }

        /* LED 天顶 */
        .stadium-led {
            position: absolute;
            width: 100%;
            height: 100%;
            top: -80px;
            border-radius: 50%;
            background: 
                radial-gradient(circle at center, transparent 50%, rgba(255, 255, 255, 0.05) 60%, transparent 70%);
            overflow: hidden;
            z-index: 3;
        }

        .led-pixel {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            opacity: 0;
            animation: ledTwinkle 0.5s ease-in-out forwards;
            box-shadow: 0 0 20px currentColor;
        }

        @keyframes ledTwinkle {
            0% { 
                opacity: 0; 
                transform: scale(0) rotate(0deg);
            }
            50% { 
                opacity: 1; 
                transform: scale(2) rotate(180deg);
            }
            100% { 
                opacity: 0.8; 
                transform: scale(1) rotate(360deg);
            }
        }

        /* 更华丽的烟花效果 */
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: fireworkExplode 2s ease-out forwards;
            box-shadow: 0 0 20px currentColor;
        }

        @keyframes fireworkExplode {
            0% { 
                transform: scale(0) rotate(0deg); 
                opacity: 1; 
            }
            20% { 
                transform: scale(2) rotate(72deg); 
                opacity: 1; 
            }
            40% { 
                transform: scale(4) rotate(144deg); 
                opacity: 0.8; 
            }
            60% { 
                transform: scale(6) rotate(216deg); 
                opacity: 0.6; 
            }
            80% { 
                transform: scale(8) rotate(288deg); 
                opacity: 0.4; 
            }
            100% { 
                transform: scale(10) rotate(360deg); 
                opacity: 0; 
            }
        }

        /* 激光束效果 */
        .laser-beam {
            position: absolute;
            width: 2px;
            height: 100vh;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                currentColor 20%, 
                currentColor 80%, 
                transparent 100%);
            opacity: 0;
            animation: laserSweep 3s ease-in-out infinite;
            box-shadow: 0 0 30px currentColor;
        }

        @keyframes laserSweep {
            0%, 100% { 
                opacity: 0; 
                transform: translateX(-100vw) rotate(-5deg);
            }
            50% { 
                opacity: 0.8; 
                transform: translateX(100vw) rotate(5deg);
            }
        }

        /* 能量波纹 */
        .energy-ring {
            position: absolute;
            border: 3px solid currentColor;
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            animation: energyExpand 2s ease-out forwards;
            box-shadow: 0 0 30px currentColor, inset 0 0 30px currentColor;
        }

        @keyframes energyExpand {
            0% { 
                width: 0; 
                height: 0; 
                opacity: 1; 
            }
            100% { 
                width: 150%; 
                height: 150%; 
                opacity: 0; 
            }
        }

        /* 结果展示区域 */
        .result-showcase {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            animation: showcaseAppear 1s ease-out 3s forwards;
        }

        @keyframes showcaseAppear {
            0% { 
                opacity: 0; 
                transform: translate(-50%, -50%) scale(0.3) rotateY(180deg); 
            }
            100% { 
                opacity: 1; 
                transform: translate(-50%, -50%) scale(1) rotateY(0deg); 
            }
        }

        .best-player-card {
            transform: scale(1.2);
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.8);
            animation: cardGlow 2s ease-in-out infinite alternate;
        }

        @keyframes cardGlow {
            0% { 
                box-shadow: 0 0 50px rgba(255, 255, 255, 0.8);
                filter: brightness(1);
            }
            100% { 
                box-shadow: 0 0 80px rgba(255, 255, 255, 1);
                filter: brightness(1.2);
            }
        }

        /* 动画进度条 */
        .animation-progress-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1000;
            overflow: hidden;
        }

        .animation-progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, 
                #00f2fe 0%, 
                #4facfe 25%, 
                #00f2fe 50%, 
                #4facfe 75%, 
                #00f2fe 100%);
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
        }

        /* 进度条阶段性颜色变化 */
        .animation-progress-bar.stage-atmosphere {
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .animation-progress-bar.stage-lights {
            background: linear-gradient(90deg, #ff9800, #ffc107);
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
        }

        .animation-progress-bar.stage-camera {
            background: linear-gradient(90deg, #9c27b0, #e91e63);
            box-shadow: 0 0 10px rgba(156, 39, 176, 0.5);
        }

        .animation-progress-bar.stage-rarity {
            background: linear-gradient(90deg, #f44336, #ff5722);
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.5);
        }

        .animation-progress-bar.stage-result {
            background: linear-gradient(90deg, #ffd700, #ffeb3b);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
        }

        .animation-progress-glow {
            position: absolute;
            top: -2px;
            left: 0;
            height: 8px;
            width: 20px;
            background: radial-gradient(ellipse, 
                rgba(255, 255, 255, 0.8) 0%, 
                rgba(79, 172, 254, 0.6) 50%, 
                transparent 100%);
            border-radius: 50%;
            animation: progressGlow 2s ease-in-out infinite;
            opacity: 0;
        }

        @keyframes progressGlow {
            0%, 100% { 
                transform: translateX(-10px) scale(0.8); 
                opacity: 0.3; 
            }
            50% { 
                transform: translateX(10px) scale(1.2); 
                opacity: 0.8; 
            }
        }

        /* 跳过按钮 */
        .skip-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 2px solid #ffd700;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0;
            transform: translateY(50px);
            animation: skipButtonAppear 0.5s ease-out 1s forwards;
            backdrop-filter: blur(10px);
            z-index: 10000;
        }

        @keyframes skipButtonAppear {
            0% { 
                opacity: 0; 
                transform: translateY(50px); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .skip-button:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        /* 3D 粒子效果 - 更缓慢柔和 */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #fff, #e3f2fd);
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 5s ease-in-out infinite; /* 延长到5秒，改为ease-in-out */
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
        }

        @keyframes particleFloat {
            0% { 
                transform: translateY(100vh) translateX(0) rotate(0deg) scale(0.3); 
                opacity: 0; 
            }
            15% { 
                opacity: 0.8; 
                transform: translateY(80vh) translateX(10px) rotate(45deg) scale(0.8);
            }
            50% { 
                opacity: 1; 
                transform: translateY(40vh) translateX(-5px) rotate(180deg) scale(1);
            }
            85% { 
                opacity: 0.8; 
                transform: translateY(10vh) translateX(15px) rotate(315deg) scale(0.9);
            }
            100% { 
                transform: translateY(-100px) translateX(20px) rotate(360deg) scale(0.2); 
                opacity: 0; 
            }
        }

        /* 镜头拉近效果 */
        .camera-zoom {
            animation: cameraZoom 3s ease-out forwards;
        }

        @keyframes cameraZoom {
            0% { 
                transform: scale(0.1) rotateX(90deg); 
                opacity: 0; 
            }
            30% { 
                transform: scale(0.5) rotateX(60deg); 
                opacity: 0.5; 
            }
            100% { 
                transform: scale(1) rotateX(0deg); 
                opacity: 1; 
            }
        }

        /* 屏幕震动效果 */
        @keyframes screenShake {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            10% { transform: translate(-2px, -1px) rotate(-0.5deg); }
            20% { transform: translate(-1px, 0px) rotate(0.5deg); }
            30% { transform: translate(2px, 1px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(0.5deg); }
            50% { transform: translate(-1px, 1px) rotate(-0.5deg); }
            60% { transform: translate(-2px, 0px) rotate(0deg); }
            70% { transform: translate(2px, 1px) rotate(-0.5deg); }
            80% { transform: translate(-1px, -1px) rotate(0.5deg); }
            90% { transform: translate(1px, 0px) rotate(0deg); }
        }

        /* 全屏闪光效果 */
        @keyframes screenFlash {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* 更华丽的粒子效果 */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFloat 4s linear infinite;
            box-shadow: 0 0 10px currentColor;
        }

        @keyframes particleFloat {
            0% { 
                transform: translateY(100vh) rotate(0deg) scale(0); 
                opacity: 0; 
            }
            10% { 
                opacity: 1; 
                transform: translateY(90vh) rotate(36deg) scale(1);
            }
            90% { 
                opacity: 1; 
                transform: translateY(-10vh) rotate(324deg) scale(1);
            }
            100% { 
                transform: translateY(-20vh) rotate(360deg) scale(0); 
                opacity: 0; 
            }
        }
    </style>
</head>
<body>
    <!-- 加载屏幕 -->
    <div id="loading-screen" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        background: linear-gradient(135deg, #0a1428 0%, #1e3c72 50%, #2a5298 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: white;
        text-align: center;
    ">
        <div style="font-size: 48px; margin-bottom: 20px; animation: rotate 2s infinite linear;">⚽</div>
        <h2 style="margin-bottom: 10px;">PES Mobile 抽卡模拟器</h2>
        <p style="margin-bottom: 20px; opacity: 0.8;">正在加载球员数据...</p>
        <div style="
            width: 200px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            overflow: hidden;
        ">
            <div style="
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, #00d4ff, #0099cc);
                transform: translateX(-100%);
                animation: loading 2s infinite;
            "></div>
        </div>
    </div>

    <!-- 横屏提示 -->
    <div class="orientation-notice">
        <div class="rotate-icon">🔄</div>
        <h2>请将设备横向放置</h2>
        <p>为了获得最佳游戏体验，请旋转您的设备到横屏模式</p>
        <p style="margin-top: 10px; font-size: 14px; opacity: 0.8;">Rotate your device to landscape mode</p>
    </div>

    <!-- 顶部导航栏 -->
    <div class="top-bar">
        <div class="logo">⚽ PES Mobile</div>
        <div class="currency-display">
            <div class="currency-item">
                <div class="coin-icon">💰</div>
                <span id="coins">99999</span>
            </div>
            <div class="currency-item">
                <div class="coin-icon">💎</div>
                <span id="gems">500</span>
            </div>
            <div class="currency-item">
                <div class="coin-icon" style="background: linear-gradient(45deg, #ff1744, #c62828);">🔥</div>
                <span id="highlight-directed-tickets">2</span>
                <small>高光定向</small>
            </div>
            <div class="currency-item">
                <div class="coin-icon" style="background: linear-gradient(45deg, #ffc107, #ff8f00);">⭐</div>
                <span id="featured-directed-tickets">5</span>
                <small>精选定向</small>
            </div>
            <div class="currency-item">
                <div class="coin-icon" style="background: linear-gradient(45deg, #ff6b6b, #ee5a52);">🎫</div>
                <span id="highlight-tickets">10</span>
                <small>高光卷</small>
            </div>
            <div class="currency-item">
                <div class="coin-icon" style="background: linear-gradient(45deg, #ffd700, #ffb300);">🎫</div>
                <span id="featured-tickets">50</span>
                <small>精选卷</small>
            </div>
            <div class="currency-item">
                <button class="gacha-btn" onclick="showRechargeModal()" style="padding: 8px 15px; font-size: 14px; background: linear-gradient(45deg, #4facfe, #00f2fe);">
                    💳 充值
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 主标题区域 -->
        <div class="hero-section">
            <h1 class="hero-title">实况足球手机版</h1>
            <p class="hero-subtitle">体验真实的球员抽卡系统</p>
        </div>

        <!-- 抽卡按钮 -->
        <div class="gacha-buttons">
            <div class="pool-section">
                <h3>高光定向卷池 (1%高光概率)</h3>
                <div class="pool-buttons">
                    <button class="gacha-btn highlight-pool" onclick="highlightDirectGacha(1)">
                        1抽 (1张定向卷)
                    </button>
                    <button class="gacha-btn highlight-pool" onclick="highlightDirectGacha(10)">
                        10连抽 (10张定向卷)
                    </button>
                    <button class="gacha-btn highlight-pool" onclick="highlightDirectGacha(20)">
                        20连抽 (20张定向卷)
                    </button>
                </div>
            </div>

            <div class="pool-section">
                <h3>精选定向卷池 (1%精选概率)</h3>
                <div class="pool-buttons">
                    <button class="gacha-btn featured-pool" onclick="featuredDirectGacha(1)">
                        1抽 (1张定向卷)
                    </button>
                    <button class="gacha-btn featured-pool" onclick="featuredDirectGacha(10)">
                        10连抽 (10张定向卷)
                    </button>
                    <button class="gacha-btn featured-pool" onclick="featuredDirectGacha(20)">
                        20连抽 (20张定向卷)
                    </button>
                </div>
            </div>

            <div class="pool-section">
                <h3>高光卷池 (10%概率)</h3>
                <div class="pool-buttons">
                    <button class="gacha-btn highlight-normal" onclick="highlightGacha(1)">
                        1抽 (1张高光卷)
                    </button>
                    <button class="gacha-btn highlight-normal" onclick="highlightGacha(10)">
                        10连抽 (10张高光卷)
                    </button>
                    <button class="gacha-btn highlight-normal" onclick="highlightGacha(20)">
                        20连抽 (20张高光卷)
                    </button>
                </div>
            </div>

            <div class="pool-section">
                <h3>精选卷池 (4%概率，250张保底10-12个精选)</h3>
                <div class="pool-buttons">
                    <button class="gacha-btn featured-normal" onclick="featuredGacha(4)">
                        4抽 (1张精选卷)
                    </button>
                    <button class="gacha-btn featured-normal" onclick="featuredGacha(10)">
                        10连抽 (3张精选卷)
                    </button>
                    <button class="gacha-btn featured-normal" onclick="featuredGacha(20)">
                        20连抽 (5张精选卷)
                    </button>
                </div>
                <div class="pity-counter">
                    精选卷已使用: <span id="featured-counter">0</span>/250 
                    (保底还需: <span id="featured-remaining">250</span>张)
                </div>
            </div>
        </div>

        <!-- 库存管理按钮 -->
        <div class="gacha-buttons">
            <button class="gacha-btn inventory-btn" onclick="showInventory()">
                查看球员库存 (共<span id="inventory-count">0</span>名球员)
            </button>
            <button class="gacha-btn release-btn" onclick="showReleaseMode()">
                球员解约模式
            </button>
        </div>

        <!-- 结果显示区域 -->
        <div class="result-area">
            <h2 class="result-title">抽卡结果</h2>
            <div class="cards-container" id="result-container">
                <p style="text-align: center; opacity: 0.7;">点击上方按钮开始抽卡</p>
            </div>
        </div>
    </div>

    <!-- 背景音乐 -->
    <audio id="bgm-audio" loop preload="auto" style="display: none;"></audio>
    <audio id="gacha-cheer-audio" preload="auto" style="display: none;">
        <source src="鼓掌欢呼声音效.mp3" type="audio/mpeg">
    </audio>

    <!-- 抽卡动画覆盖层 -->
    <div class="gacha-animation-overlay" id="gacha-animation">
        <div class="stadium-container">
            <div class="stadium camera-zoom">
                <div class="stadium-field">
                    <div class="field-lines">
                        <div class="center-circle"></div>
                        <div class="penalty-area left"></div>
                        <div class="penalty-area right"></div>
                    </div>
                </div>
                <div class="stadium-lights" id="stadium-lights"></div>
                <div class="stadium-led" id="stadium-led"></div>
            </div>
        </div>
        <div class="fireworks-container" id="fireworks"></div>
        <div class="laser-container" id="laser-container"></div>
        <div class="energy-container" id="energy-container"></div>
        <div class="result-showcase" id="result-showcase"></div>
        
        <!-- 动画进度条 -->
        <div class="animation-progress-container">
            <div class="animation-progress-bar" id="animation-progress-bar"></div>
            <div class="animation-progress-glow" id="animation-progress-glow"></div>
        </div>
        
        <button class="skip-button" id="skip-button" onclick="skipGachaAnimation()">
            ⚡ 跳过动画
        </button>
    </div>

    <!-- 充值界面模态框 -->
    <div class="recharge-modal" id="recharge-modal">
        <div class="recharge-content">
            <button class="close-btn" onclick="hideRechargeModal()">×</button>
            
            <div class="recharge-header">
                <div class="recharge-title">💳 球员卷充值</div>
                <div class="recharge-subtitle">选择你需要的球员卷类型</div>
            </div>

            <div class="recharge-options">
                <!-- 高光定向卷 -->
                <div class="recharge-option highlight-directed">
                    <div class="recharge-icon">🔥</div>
                    <div class="recharge-name">高光定向卷</div>
                    <div class="recharge-price">💎 1000</div>
                    <div class="recharge-quantity">获得 10 张</div>
                    <button class="purchase-btn" onclick="purchaseTickets('highlight-directed')">立即购买</button>
                </div>

                <!-- 精选定向卷 -->
                <div class="recharge-option featured-directed">
                    <div class="recharge-icon">⭐</div>
                    <div class="recharge-name">精选定向卷</div>
                    <div class="recharge-price">💎 1000</div>
                    <div class="recharge-quantity">获得 10 张</div>
                    <button class="purchase-btn" onclick="purchaseTickets('featured-directed')">立即购买</button>
                </div>

                <!-- 高光卷 -->
                <div class="recharge-option highlight-normal">
                    <div class="recharge-icon">🎫</div>
                    <div class="recharge-name">高光卷</div>
                    <div class="recharge-price">💎 50000</div>
                    <div class="recharge-quantity">获得 10 张</div>
                    <button class="purchase-btn" onclick="purchaseTickets('highlight-normal')">立即购买</button>
                </div>

                <!-- 精选卷 -->
                <div class="recharge-option featured-normal">
                    <div class="recharge-icon">🎟️</div>
                    <div class="recharge-name">精选卷</div>
                    <div class="recharge-price">💎 50000</div>
                    <div class="recharge-quantity">获得 10 张</div>
                    <button class="purchase-btn" onclick="purchaseTickets('featured-normal')">立即购买</button>
                </div>
            </div>

            <div style="text-align: center; color: rgba(255, 255, 255, 0.7); font-size: 14px;">
                ⚠️ 请根据需要合理充值，理性消费
            </div>
        </div>
    </div>

    <script src="card-system.js"></script>
    <script>
        // 移动端全屏和横屏管理
        class MobileFullscreenManager {
            constructor() {
                this.init();
            }

            init() {
                // 页面加载完成后立即尝试全屏
                document.addEventListener('DOMContentLoaded', () => {
                    this.handleMobileOptimization();
                });

                // 监听屏幕方向变化
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.handleOrientationChange(), 500);
                });

                // 监听窗口大小变化
                window.addEventListener('resize', () => {
                    this.handleOrientationChange();
                });

                // 触摸开始时尝试全屏
                document.addEventListener('touchstart', this.tryEnterFullscreen.bind(this), { once: true });
                
                // 点击开始时尝试全屏
                document.addEventListener('click', this.tryEnterFullscreen.bind(this), { once: true });
            }

            handleMobileOptimization() {
                // 检测移动设备
                if (this.isMobile()) {
                    // 隐藏地址栏
                    this.hideAddressBar();
                    
                    // 设置viewport高度
                    this.setViewportHeight();
                    
                    // 处理屏幕方向
                    this.handleOrientationChange();
                    
                    // 阻止默认滚动行为
                    this.preventScrolling();
                }
            }

            isMobile() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }

            hideAddressBar() {
                // 滚动到顶部隐藏地址栏
                window.scrollTo(0, 1);
                setTimeout(() => window.scrollTo(0, 0), 100);
            }

            setViewportHeight() {
                // 设置CSS自定义属性为实际视口高度
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }

            handleOrientationChange() {
                setTimeout(() => {
                    this.setViewportHeight();
                    
                    // 只在移动设备上处理横屏提示
                    if (this.isMobile()) {
                        // 检查是否为横屏
                        const isLandscape = window.innerWidth > window.innerHeight;
                        const orientationNotice = document.querySelector('.orientation-notice');
                        
                        if (orientationNotice) {
                            orientationNotice.style.display = isLandscape ? 'none' : 'flex';
                        }
                        
                        // 横屏时隐藏地址栏
                        if (isLandscape) {
                            this.hideAddressBar();
                        }
                    }
                }, 100);
            }

            tryEnterFullscreen() {
                if (this.isMobile()) {
                    const element = document.documentElement;
                    
                    // 尝试进入全屏
                    if (element.requestFullscreen) {
                        element.requestFullscreen().catch(e => console.log('全屏失败:', e));
                    } else if (element.webkitRequestFullscreen) {
                        element.webkitRequestFullscreen().catch(e => console.log('全屏失败:', e));
                    } else if (element.mozRequestFullScreen) {
                        element.mozRequestFullScreen().catch(e => console.log('全屏失败:', e));
                    } else if (element.msRequestFullscreen) {
                        element.msRequestFullscreen().catch(e => console.log('全屏失败:', e));
                    }
                    
                    this.hideAddressBar();
                }
            }

            preventScrolling() {
                // 阻止页面滚动
                document.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                }, { passive: false });
                
                // 阻止双击缩放
                let lastTouchEnd = 0;
                document.addEventListener('touchend', function(event) {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }
        }

        // 初始化移动端管理器
        const mobileManager = new MobileFullscreenManager();

        // 触摸手势增强
        class TouchEnhancer {
            constructor() {
                this.initTouchFeedback();
            }

            initTouchFeedback() {
                // 为所有按钮添加触摸反馈
                document.addEventListener('touchstart', (e) => {
                    const target = e.target.closest('button, .pool-card, .gacha-button');
                    if (target) {
                        target.style.transform = 'scale(0.98)';
                        target.style.opacity = '0.9';
                    }
                });

                document.addEventListener('touchend', (e) => {
                    const target = e.target.closest('button, .pool-card, .gacha-button');
                    if (target) {
                        setTimeout(() => {
                            target.style.transform = '';
                            target.style.opacity = '';
                        }, 150);
                    }
                });

                // 长按振动反馈（如果支持）
                document.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    if ('vibrate' in navigator) {
                        navigator.vibrate(50);
                    }
                });
            }
        }

        // 初始化触摸增强
        const touchEnhancer = new TouchEnhancer();

        // 从外部文件加载球员数据
        let playersData = [];
        let gachaSystem = {};
        
        // 加载球员数据
        fetch('players_data_complete.json')
            .then(response => response.json())
            .then(data => {
                playersData = data.球员;
                gachaSystem = data;
                console.log('球员数据加载完成:', playersData.length, '名球员');
                console.log('卡池系统加载完成');
                
                // 隐藏加载屏幕
                setTimeout(() => {
                    const loadingScreen = document.getElementById('loading-screen');
                    if (loadingScreen) {
                        loadingScreen.style.opacity = '0';
                        loadingScreen.style.transition = 'opacity 0.5s ease';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                        }, 500);
                    }
                }, 1000);
            })
            .catch(error => {
                console.error('加载球员数据失败:', error);
                // 使用备用数据
                playersData = [
                    {
                        "姓名": "梅西",
                        "稀有度": "传奇高光",
                        "总评": 98,
                        "位置": "RWF",
                        "国籍": "阿根廷",
                        "俱乐部": "迈阿密国际",
                        "年龄": 36,
                        "身高": 170,
                        "体重": 72,
                        "惯用脚": "左脚",
                        "能力值": {
                            "进攻": 98,
                            "防守": 38,
                            "身体": 78,
                            "速度": 85,
                            "传球": 95,
                            "运球": 99
                        },
                        "特殊技能": ["轻触射门", "低空传球", "单触传球", "马赛回转"],
                        "战术风格": "创造型前腰",
                        "球员类型": "创造型",
                        "星级": 5
                    }
                ];
            });

        // 货币系统 - 新增各种卷
        let playerCurrency = {
            coins: 99999,
            gems: 500000,
            高光定向卷: 100,
            精选定向卷: 500,
            高光卷: 50,
            精选卷: 150
        };

        // 用户球员库存
        let playerInventory = [];
        
        // 精选卷保底计数器
        let featuredGachaCounter = 0;
        let guaranteedFeaturedCount = 0;

        // 背景音乐系统
        const bgmAudio = document.getElementById('bgm-audio');
        let currentBGMIndex = -1;
        let bgmFadeInterval = null;
        
        // 音乐曲库 - 使用本地bgm文件夹的音乐文件
        const bgmPlaylist = [
            'bgm/0.flac.mp3',
            'bgm/1.flac.mp3',
            'bgm/2.flac.mp3',
            'bgm/3.flac.mp3',
            'bgm/4.flac.mp3',
            'bgm/5.flac.mp3',
            'bgm/6.flac.mp3',
            'bgm/7.flac.mp3',
            'bgm/8.flac.mp3',
            'bgm/9.flac.mp3',
            'bgm/10.flac.mp3',
            'bgm/11.flac.mp3',
            'bgm/12.flac.mp3',
            'bgm/13.flac.mp3',
            'bgm/14.flac.mp3',
            'bgm/15.flac.mp3',
            'bgm/16.flac.mp3',
            'bgm/17.flac.mp3',
            'bgm/18.flac.mp3',
            'bgm/19.flac.mp3',
            'bgm/20.flac.mp3',
            'bgm/21.flac.mp3',
            'bgm/22.flac.mp3',
            'bgm/23.flac.mp3'
        ];

        // 稀有度概率 - 更新为真实概率
        const rarityRates = {
            '普卡': 1,         // 99% - 2-3星
            '梦幻精选': 0,     // 0.5% - 4星
            '精选': 0,         // 0.4% - 4星高 (精选卷基础概率)
            '高光': 0,        // 0.09% - 5星 (高光卷基础概率)
            '传奇高光': 0     // 0.01% - 5星顶级
        };

        // 稀有度中文名和样式
        const rarityConfig = {
            '普卡': { name: '普卡', class: 'normal-card' },
            '梦幻精选': { name: '梦幻精选', class: 'dream-featured' },
            '精选': { name: '精选', class: 'featured' },
            '高光': { name: '高光', class: 'highlight' },
            '传奇高光': { name: '传奇高光', class: 'legend-highlight' }
        };

        // 随机选择稀有度
        function getRandomRarity() {
            const random = Math.random();
            let accumulated = 0;
            
            for (const [rarity, rate] of Object.entries(rarityRates)) {
                accumulated += rate;
                if (random <= accumulated) {
                    return rarity;
                }
            }
            return 'white-ball';
        }

        // 根据稀有度获取球员
        function getPlayerByRarity(targetRarity) {
            const playersOfRarity = playersData.filter(player => player.稀有度 === targetRarity);
            if (playersOfRarity.length > 0) {
                return playersOfRarity[Math.floor(Math.random() * playersOfRarity.length)];
            }
            // 如果没有该稀有度的球员，返回普卡球员
            const normalPlayers = playersData.filter(player => player.稀有度 === '普卡');
            return normalPlayers[Math.floor(Math.random() * normalPlayers.length)] || playersData[0];
        }

        // 创建球员卡片HTML
        function createPlayerCard(player, showButtons = false) {
            const rarityConfig = {
                '普卡': 'normal-card',
                '梦幻精选': 'dream-featured',
                '精选': 'featured',
                '高光': 'highlight',
                '传奇高光': 'legend-highlight'
            };

            const sparkles = Array.from({length: 5}, (_, i) => 
                `<div class="sparkle" style="top: ${Math.random() * 100}%; left: ${Math.random() * 100}%; animation-delay: ${i * 0.3}s;"></div>`
            ).join('');

            const buttonsHtml = showButtons ? `
                <div class="card-buttons">
                    <button class="release-btn" onclick="releasePlayer('${player.姓名}')">
                        解约 (获得 ${getReleaseReward(player)})
                    </button>
                </div>
            ` : '';

            return `
                <div class="player-card" onclick="flipCard(this)">
                    <div class="card-inner">
                        <div class="card-front ${rarityConfig[player.稀有度] || 'normal-card'}">
                            ${sparkles}
                            <div class="card-header">
                                <div class="rarity-badge">${player.稀有度}</div>
                                <div class="player-name">${player.姓名}</div>
                                <div class="player-overall">${player.总评}</div>
                            </div>
                            <div class="card-body">
                                <div class="player-info">
                                    <div class="player-position">${player.位置}</div>
                                    <div class="player-club">${player.俱乐部}</div>
                                    <div class="player-nationality">${player.国籍}</div>
                                    <div class="star-rating">${'⭐'.repeat(player.星级 || 3)}</div>
                                </div>
                                ${!showButtons ? `<div class="click-hint-small">👆 点击查看详情</div>` : ''}
                            </div>
                            ${buttonsHtml}
                        </div>
                        <div class="card-back ${rarityConfig[player.稀有度] || 'normal-card'}">
                            ${showButtons ? `
                            <div style="width: 100%;">
                                <h3 style="margin-bottom: 20px;">${player.姓名} 详细数据</h3>
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-label">进攻</div>
                                        <div class="stat-value">${player.能力值.进攻}</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">防守</div>
                                        <div class="stat-value">${player.能力值.防守}</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">身体</div>
                                        <div class="stat-value">${player.能力值.身体}</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">速度</div>
                                        <div class="stat-value">${player.能力值.速度}</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">传球</div>
                                        <div class="stat-value">${player.能力值.传球}</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">运球</div>
                                        <div class="stat-value">${player.能力值.运球}</div>
                                    </div>
                                </div>
                                <div style="margin-top: 20px; font-size: 14px;">
                                    <div><strong>身高:</strong> ${player.身高}cm</div>
                                    <div><strong>体重:</strong> ${player.体重}kg</div>
                                    <div><strong>惯用脚:</strong> ${player.惯用脚}</div>
                                    <div><strong>类型:</strong> ${player.球员类型}</div>
                                </div>
                            </div>
                            ` : `
                            <div class="mystery-card-back">
                                <div class="mystery-content">
                                    <div class="pes-logo">⚽</div>
                                    <h3>PES Mobile</h3>
                                    <p>球员卡片</p>
                                    <div class="click-hint">
                                        <div class="click-icon">👆</div>
                                        <p>点击翻卡</p>
                                    </div>
                                </div>
                                ${sparkles}
                            </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        // 获取解约奖励
        function getReleaseReward(player) {
            if (player.稀有度 === '高光' || player.稀有度 === '传奇高光') {
                return '2张高光卷';
            } else if (player.稀有度 === '精选') {
                const rating = player.总评;
                if (rating >= 98) return '6张精选卷';
                if (rating >= 97) return '5张精选卷';
                if (rating >= 96) return '4张精选卷';
                if (rating >= 95) return '3张精选卷';
                if (rating >= 94) return '2张精选卷';
                return '1张精选卷';
            } else if (player.稀有度 === '梦幻精选') {
                return '1张精选卷';
            }
            return '无奖励';
        }

        // 高光定向卷池 (1%高光概率)
        function highlightDirectGacha(times) {
            const cost = getCost(times, 'other');
            if (playerCurrency.高光定向卷 < cost) {
                alert(`高光定向卷不足！需要${cost}张`);
                return;
            }

            playerCurrency.高光定向卷 -= cost;
            startGachaAnimation(times, '高光定向卷池');
        }

        // 精选定向卷池 (1%精选概率)
        function featuredDirectGacha(times) {
            const cost = getCost(times, 'other');
            if (playerCurrency.精选定向卷 < cost) {
                alert(`精选定向卷不足！需要${cost}张`);
                return;
            }

            playerCurrency.精选定向卷 -= cost;
            startGachaAnimation(times, '精选定向卷池');
        }

        // 高光卷池 (10%高光概率)
        function highlightGacha(times) {
            const cost = getCost(times, 'other');
            if (playerCurrency.高光卷 < cost) {
                alert(`高光卷不足！需要${cost}张`);
                return;
            }

            playerCurrency.高光卷 -= cost;
            startGachaAnimation(times, '高光卷池');
        }

        // 精选卷池 (4%精选，250张保底10-12个)
        function featuredGacha(times) {
            const cost = getCost(times, 'featured');
            if (playerCurrency.精选卷 < cost) {
                alert(`精选卷不足！需要${cost}张`);
                return;
            }

            playerCurrency.精选卷 -= cost;
            featuredGachaCounter += cost;
            
            // 检查保底
            if (featuredGachaCounter >= 250) {
                startGachaAnimationWithPity(times);
                return;
            }
            
            startGachaAnimation(times, '精选卷池');
        }

        // 获取抽卡消耗 - 不同卷类型不同计费
        function getCost(times, poolType = 'featured') {
            if (poolType === 'featured') {
                // 精选卷: 1张抽4个，4抽/10连/20连按比例
                switch(times) {
                    case 4: return 1;   // 4抽 = 1张卷
                    case 10: return 3;  // 10连抽 = 3张卷  
                    case 20: return 5;  // 20连抽 = 5张卷
                    default: return 1;
                }
            } else {
                // 其他卷: 1张1抽，10张10抽，20张20抽
                switch(times) {
                    case 1: return 1;   // 1抽 = 1张卷
                    case 4: return 4;   // 4抽 = 4张卷
                    case 10: return 10; // 10连抽 = 10张卷  
                    case 20: return 20; // 20连抽 = 20张卷
                    default: return times;
                }
            }
        }

        // 处理精选卷保底
        function handleFeaturedPity(times) {
            const guaranteedCount = 10 + Math.floor(Math.random() * 3); // 10-12个随机
            const results = [];
            
            // 保底精选球员
            for (let i = 0; i < guaranteedCount; i++) {
                const player = getPlayerByRarity('精选');
                if (player) {
                    const isNew = !playerInventory.some(p => p.姓名 === player.姓名);
                    if (isNew) {
                        playerInventory.push({...player, 获得时间: new Date().toISOString()});
                    }
                    results.push({player, isNew, isPity: true});
                }
            }
            
            // 剩余普通抽卡
            const remainingTimes = times - guaranteedCount;
            for (let i = 0; i < remainingTimes; i++) {
                const rarity = getRandomRarity();
                const player = getPlayerByRarity(rarity);
                if (player) {
                    const isNew = !playerInventory.some(p => p.姓名 === player.姓名);
                    if (isNew) {
                        playerInventory.push({...player, 获得时间: new Date().toISOString()});
                    }
                    results.push({player, isNew});
                }
            }

            // 重置保底计数器
            featuredGachaCounter = 0;
            guaranteedFeaturedCount += guaranteedCount;

            displayGachaResults(results, `精选卷池 - 保底触发！获得${guaranteedCount}个精选球员`);
            updateCurrencyDisplay();
            updateInventoryCount();
            updatePityCounter();
        }

        // 执行抽卡 - 修正为真实的1%概率
        function performGacha(times, poolName) {
            const results = [];
            
            for (let i = 0; i < times; i++) {
                let targetRarity = null;
                
                if (poolName === '高光定向卷池') {
                    // 1%高光概率 (不是100%!)
                    const random = Math.random();
                    if (random < 0.001) {
                        targetRarity = '传奇高光';  // 0.1%传奇高光
                    } else if (random < 0.01) {
                        targetRarity = '高光';      // 0.9%普通高光
                    }
                    // 99%概率走正常抽卡
                } else if (poolName === '精选定向卷池') {
                    // 1%精选概率 (不是100%!)
                    if (Math.random() < 0.01) {
                        targetRarity = '精选';      // 1%精选
                    }
                    // 99%概率走正常抽卡
                } else if (poolName === '高光卷池') {
                    // 10%高光概率
                    const random = Math.random();
                    if (random < 0.01) {
                        targetRarity = '传奇高光';  // 1%传奇高光
                    } else if (random < 0.10) {
                        targetRarity = '高光';      // 9%普通高光
                    }
                    // 90%概率走正常抽卡
                } else if (poolName === '精选卷池') {
                    // 4%精选概率
                    if (Math.random() < 0.04) {
                        targetRarity = '精选';      // 4%精选
                    }
                    // 96%概率走正常抽卡
                }
                
                // 如果没有触发特殊概率，使用普通概率
                if (!targetRarity) {
                    targetRarity = getRandomRarity();
                }
                
                const player = getPlayerByRarity(targetRarity);
                if (player) {
                    // 检查是否已拥有该球员
                    const isNew = !playerInventory.some(p => p.姓名 === player.姓名);
                    if (isNew) {
                        playerInventory.push({...player, 获得时间: new Date().toISOString()});
                    }
                    results.push({player, isNew});
                }
            }

            // 显示结果
            displayGachaResults(results, poolName);
            updateCurrencyDisplay();
            updateInventoryCount();
            updatePityCounter();
        }

        // 更新保底计数器显示
        function updatePityCounter() {
            document.getElementById('featured-counter').textContent = featuredGachaCounter;
            document.getElementById('featured-remaining').textContent = Math.max(0, 250 - featuredGachaCounter);
        }

        // 显示抽卡结果
        function displayGachaResults(results, poolName) {
            const resultContainer = document.getElementById('result-container');
            const title = document.querySelector('.result-title');
            
            title.innerHTML = `${poolName} - 抽卡结果 (${results.length}张卡片) <small style="font-size: 14px; opacity: 0.7;">点击卡片查看详情</small>`;
            
            const cardsHtml = results.map(result => {
                const cardHtml = createPlayerCard(result.player);
                let badges = '';
                if (result.isNew) badges += '<div class="new-badge">NEW!</div>';
                if (result.isPity) badges += '<div class="pity-badge">保底!</div>';
                return cardHtml.replace('</div>', badges + '</div>');
            }).join('');
            
            resultContainer.innerHTML = cardsHtml;

            // 初始显示为背面 (移除自动翻转动画)
            const cards = resultContainer.querySelectorAll('.player-card .card-inner');
            cards.forEach((card) => {
                card.style.transform = 'rotateY(180deg)'; // 初始显示背面
            });
        }

        // 球员解约
        function releasePlayer(playerName) {
            const playerIndex = playerInventory.findIndex(p => p.姓名 === playerName);
            if (playerIndex === -1) {
                alert('未找到该球员！');
                return;
            }

            const player = playerInventory[playerIndex];
            const reward = getReleaseReward(player);
            
            if (confirm(`确定要解约 ${playerName} 吗？\n解约将获得：${reward}`)) {
                // 移除球员
                playerInventory.splice(playerIndex, 1);
                
                // 给予奖励
                if (reward.includes('高光卷')) {
                    const count = parseInt(reward.match(/\d+/)[0]);
                    playerCurrency.高光卷 += count;
                } else if (reward.includes('精选卷')) {
                    const count = parseInt(reward.match(/\d+/)[0]);
                    playerCurrency.精选卷 += count;
                } else if (reward.includes('梦幻精选卷')) {
                    const count = parseInt(reward.match(/\d+/)[0]);
                    playerCurrency.精选卷 += Math.floor(count / 2); // 梦幻精选转换为精选卷
                }
                
                // 立即保存数据到localStorage
                localStorage.setItem('pesPlayerInventory', JSON.stringify(playerInventory));
                localStorage.setItem('pesCurrency', JSON.stringify(playerCurrency));
                
                updateCurrencyDisplay();
                updateInventoryCount();
                
                // 检查当前页面状态并刷新显示
                const currentTitle = document.querySelector('.result-title').textContent;
                if (currentTitle.includes('球员库存') || currentTitle.includes('解约模式')) {
                    // 重新显示当前页面
                    if (currentTitle.includes('库存')) {
                        showInventory();
                    } else if (currentTitle.includes('解约模式')) {
                        showReleaseMode();
                    }
                }
                
                alert(`${playerName} 已解约！获得 ${reward}`);
            }
        }

        // 显示库存
        function showInventory() {
            const resultContainer = document.getElementById('result-container');
            const title = document.querySelector('.result-title');
            
            title.textContent = `球员库存 (${playerInventory.length}名球员)`;
            
            if (playerInventory.length === 0) {
                resultContainer.innerHTML = '<p style="text-align: center; opacity: 0.7;">暂无球员，快去抽卡吧！</p>';
                return;
            }

            const cardsHtml = playerInventory.map(player => createPlayerCard(player, true)).join('');
            resultContainer.innerHTML = cardsHtml;
        }

        // 显示解约模式
        function showReleaseMode() {
            const resultContainer = document.getElementById('result-container');
            const title = document.querySelector('.result-title');
            
            title.textContent = '球员解约模式 - 点击球员卡片进行解约';
            
            if (playerInventory.length === 0) {
                resultContainer.innerHTML = '<p style="text-align: center; opacity: 0.7;">暂无球员可解约！</p>';
                return;
            }

            const cardsHtml = playerInventory.map(player => createPlayerCard(player, true)).join('');
            resultContainer.innerHTML = cardsHtml;
        }

        // 更新库存数量显示
        function updateInventoryCount() {
            document.getElementById('inventory-count').textContent = playerInventory.length;
        }

        // 卡片翻转
        function flipCard(cardElement) {
            const cardInner = cardElement.querySelector('.card-inner');
            const isFlipped = cardInner.style.transform === 'rotateY(0deg)' || cardInner.style.transform === '';
            
            // 添加翻转动画
            cardElement.style.pointerEvents = 'none'; // 防止重复点击
            
            if (isFlipped) {
                cardInner.style.transform = 'rotateY(180deg)'; // 翻到背面
            } else {
                cardInner.style.transform = 'rotateY(0deg)';   // 翻到正面
            }
            
            // 重新启用点击
            setTimeout(() => {
                cardElement.style.pointerEvents = 'auto';
            }, 600);
        }

        // 更新货币显示
        function updateCurrencyDisplay() {
            document.getElementById('coins').textContent = playerCurrency.coins;
            document.getElementById('gems').textContent = playerCurrency.gems;
            document.getElementById('highlight-directed-tickets').textContent = playerCurrency.高光定向卷;
            document.getElementById('featured-directed-tickets').textContent = playerCurrency.精选定向卷;
            document.getElementById('highlight-tickets').textContent = playerCurrency.高光卷;
            document.getElementById('featured-tickets').textContent = playerCurrency.精选卷;
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrencyDisplay();
            updateInventoryCount();
            updatePityCounter();
            
            // 每30秒自动保存
            setInterval(() => {
                localStorage.setItem('pesPlayerInventory', JSON.stringify(playerInventory));
                localStorage.setItem('pesCurrency', JSON.stringify(playerCurrency));
                localStorage.setItem('pesFeaturedCounter', featuredGachaCounter.toString());
            }, 30000);
            
            // 加载保存的数据
            const savedInventory = localStorage.getItem('pesPlayerInventory');
            const savedCurrency = localStorage.getItem('pesCurrency');
            const savedCounter = localStorage.getItem('pesFeaturedCounter');
            
            if (savedInventory) {
                playerInventory = JSON.parse(savedInventory);
                updateInventoryCount();
            }
            
            if (savedCurrency) {
                Object.assign(playerCurrency, JSON.parse(savedCurrency));
                updateCurrencyDisplay();
            }
            
            if (savedCounter) {
                featuredGachaCounter = parseInt(savedCounter);
                updatePityCounter();
            }

            // 充值功能
            window.showRechargeModal = function() {
                document.getElementById('recharge-modal').style.display = 'flex';
            };

            window.hideRechargeModal = function() {
                document.getElementById('recharge-modal').style.display = 'none';
            };

            window.purchaseTickets = function(ticketType) {
                const packages = {
                    'highlight-directed': {
                        name: '高光定向卷',
                        cost: 1000,
                        currency: 'gems',
                        tickets: 10,
                        ticketKey: '高光定向卷'
                    },
                    'featured-directed': {
                        name: '精选定向卷',
                        cost: 1000,
                        currency: 'gems',
                        tickets: 10,
                        ticketKey: '精选定向卷'
                    },
                    'highlight-normal': {
                        name: '高光卷',
                        cost: 50000,
                        currency: 'gems',
                        tickets: 10,
                        ticketKey: '高光卷'
                    },
                    'featured-normal': {
                        name: '精选卷',
                        cost: 50000,
                        currency: 'gems',
                        tickets: 10,
                        ticketKey: '精选卷'
                    }
                };

                const packageInfo = packages[ticketType];
                if (!packageInfo) return;

                // 检查货币是否足够
                if (playerCurrency[packageInfo.currency] < packageInfo.cost) {
                    alert(`💎 钻石不足！需要 ${packageInfo.cost} 钻石，当前只有 ${playerCurrency[packageInfo.currency]} 钻石。`);
                    return;
                }

                // 确认购买
                const confirmMsg = `确认购买 ${packageInfo.name}？\n\n💎 消耗：${packageInfo.cost} 钻石\n🎫 获得：${packageInfo.tickets} 张 ${packageInfo.name}\n\n当前钻石：${playerCurrency[packageInfo.currency]}`;
                
                if (!confirm(confirmMsg)) return;

                // 执行购买
                playerCurrency[packageInfo.currency] -= packageInfo.cost;
                
                // 添加对应的卷
                playerCurrency[packageInfo.ticketKey] = (playerCurrency[packageInfo.ticketKey] || 0) + packageInfo.tickets;

                // 更新显示
                updateCurrencyDisplay();
                
                // 保存数据
                localStorage.setItem('pesCurrency', JSON.stringify(playerCurrency));

                // 显示购买成功
                alert(`🎉 购买成功！\n\n获得了 ${packageInfo.tickets} 张 ${packageInfo.name}！\n剩余钻石：${playerCurrency[packageInfo.currency]}`);

                // 关闭充值界面
                hideRechargeModal();
            };

            // 点击充值界面外部关闭
            document.getElementById('recharge-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    hideRechargeModal();
                }
            });

            // 添加点击监听，用于显示跳过按钮
            document.addEventListener('click', showSkipButton);
            document.addEventListener('keydown', showSkipButton);
            
            // 初始化背景音乐
            initializeBGM();
        });

        // 背景音乐控制系统
        function initializeBGM() {
            // 设置音频基础属性
            bgmAudio.volume = 0;
            bgmAudio.loop = false;  // 不循环，播放完自动切换到下一首
            
            // 开始播放随机音乐
            playRandomBGM();
            
            // 监听音频加载错误，自动切换到下一首
            bgmAudio.addEventListener('error', () => {
                console.log('音频加载失败，切换到下一首');
                playRandomBGM();
            });
            
            // 监听音频结束，自动播放下一首随机音乐
            bgmAudio.addEventListener('ended', () => {
                console.log('音乐播放完毕，切换到下一首随机音乐');
                playRandomBGM();
            });
        }

        // 播放随机背景音乐
        function playRandomBGM() {
            console.log('尝试播放随机BGM');
            
            if (!bgmAudio) {
                console.error('bgmAudio元素不存在');
                return;
            }
            
            // 随机选择一首音乐（确保不重复）
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * bgmPlaylist.length);
            } while (newIndex === currentBGMIndex && bgmPlaylist.length > 1);
            
            currentBGMIndex = newIndex;
            
            // 设置音源
            const audioSrc = bgmPlaylist[currentBGMIndex];
            console.log('设置BGM音源:', audioSrc);
            bgmAudio.src = audioSrc;
            
            // 加载音频
            try {
                bgmAudio.load();
                console.log('BGM加载完成，准备播放');
                // 淡入播放
                fadeInBGM();
            } catch (e) {
                console.log('BGM加载异常:', e);
                isBGMInitialized = false;
            }
        }

        // 淡入背景音乐
        function fadeInBGM() {
            bgmAudio.volume = 0;
            bgmAudio.play().catch(error => {
                console.log('音频播放失败:', error);
                // 如果播放失败，尝试下一首
                setTimeout(playRandomBGM, 1000);
                return;
            });
            
            // 2秒淡入
            const fadeInDuration = 2000;
            const targetVolume = 0.3; // 目标音量（30%）
            const fadeInSteps = 50;
            const stepDuration = fadeInDuration / fadeInSteps;
            const volumeStep = targetVolume / fadeInSteps;
            
            let currentStep = 0;
            
            bgmFadeInterval = setInterval(() => {
                currentStep++;
                const newVolume = Math.min(volumeStep * currentStep, targetVolume);
                bgmAudio.volume = newVolume;
                
                if (currentStep >= fadeInSteps) {
                    clearInterval(bgmFadeInterval);
                    bgmFadeInterval = null;
                }
            }, stepDuration);
        }

        // 淡出背景音乐
        function fadeOutBGM(callback) {
            if (bgmFadeInterval) {
                clearInterval(bgmFadeInterval);
                bgmFadeInterval = null;
            }
            
            // 2秒淡出
            const fadeOutDuration = 2000;
            const fadeOutSteps = 50;
            const stepDuration = fadeOutDuration / fadeOutSteps;
            const currentVolume = bgmAudio.volume;
            const volumeStep = currentVolume / fadeOutSteps;
            
            let currentStep = 0;
            
            bgmFadeInterval = setInterval(() => {
                currentStep++;
                const newVolume = Math.max(currentVolume - (volumeStep * currentStep), 0);
                bgmAudio.volume = newVolume;
                
                if (currentStep >= fadeOutSteps || newVolume <= 0) {
                    clearInterval(bgmFadeInterval);
                    bgmFadeInterval = null;
                    bgmAudio.pause();
                    
                    if (callback) {
                        callback();
                    }
                }
            }, stepDuration);
        }

        // 暂停背景音乐（抽卡时）
        function pauseBGMForGacha() {
            fadeOutBGM();
        }

        // 恢复背景音乐（抽卡结束后）
        function resumeBGMAfterGacha() {
            // 延迟1秒后播放新的随机音乐
            setTimeout(() => {
                playRandomBGM();
            }, 1000);
        }

        // 抽球音效系统 - 使用Web Audio API合成
        let audioContext = null;
        let drumBeatPattern = null;
        let cheerSoundGain = null;
        let drumGain = null;
        let gachaAudioActive = false;

        // 初始化音频上下文
        function initGachaAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // 如果音频上下文被暂停，尝试恢复
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        console.log('音频上下文已恢复');
                    }).catch(err => {
                        console.log('音频上下文恢复失败:', err);
                    });
                }
            }
            return audioContext;
        }

        // 创建鼓点节拍
        function createDrumBeat() {
            const ctx = audioContext;
            const duration = 0.2; // 稍微延长鼓点持续时间
            
            // 创建鼓点音频缓冲区
            const buffer = ctx.createBuffer(1, ctx.sampleRate * duration, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            
            // 生成更真实的鼓点声音
            for (let i = 0; i < data.length; i++) {
                const t = i / ctx.sampleRate;
                const envelope = Math.exp(-t * 25); // 快速衰减包络
                
                // 底鼓部分 - 低频重击
                const kickFreq = 50 + Math.sin(t * 100) * 20; // 频率略有变化
                const kick = Math.sin(2 * Math.PI * kickFreq * t) * envelope * 0.8;
                
                // 军鼓部分 - 中高频
                const snareEnv = Math.exp(-t * 40); // 更快衰减
                const snare = (Math.random() * 2 - 1) * snareEnv * 0.4; // 噪声
                const snareClick = Math.sin(2 * Math.PI * 180 * t) * snareEnv * 0.3;
                
                // 高频点缀
                const hihat = (Math.random() * 2 - 1) * Math.exp(-t * 60) * 0.2;
                
                // 混合所有元素
                data[i] = (kick + snare + snareClick + hihat) * 0.9;
            }
            
            return buffer;
        }

        // 创建欢呼声效果 - 简化版本
        function createCheerSound() {
            const ctx = audioContext;
            const duration = 3.0;
            const sampleRate = ctx.sampleRate;
            
            // 创建单声道缓冲区先测试
            const buffer = ctx.createBuffer(1, sampleRate * duration, sampleRate);
            const data = buffer.getChannelData(0);
            
            // 生成简单但有效的欢呼声
            for (let i = 0; i < data.length; i++) {
                const t = i / sampleRate;
                
                // 简单包络：前1秒渐入，中间1秒满音量，后1秒渐出
                let envelope;
                if (t < 1) {
                    envelope = t; // 渐入
                } else if (t < 2) {
                    envelope = 1; // 满音量
                } else {
                    envelope = 3 - t; // 渐出
                }
                
                // 基础白噪声
                let sample = (Math.random() * 2 - 1) * 0.4;
                
                // 添加周期性变化模拟人群起伏
                const crowdWave = Math.sin(2 * Math.PI * 2 * t) * 0.3 + 0.7; // 2Hz变化
                sample *= crowdWave;
                
                // 偶尔的强烈拍手或呼喊
                if (Math.random() < 0.02) { // 2%概率
                    sample += (Math.random() * 2 - 1) * 0.6;
                }
                
                // 应用包络
                data[i] = sample * envelope;
            }
            
            console.log('欢呼声缓冲区生成完成，长度:', data.length, '样本');
            return buffer;
        }

        // 开始抽球音效序列
        function startGachaAudioSequence() {
            try {
                if (!audioContext) {
                    initGachaAudio();
                }
                
                // 确保音频上下文处于运行状态
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        startGachaAudioSequenceInternal();
                    }).catch(err => {
                        console.log('无法启动音频效果:', err);
                    });
                } else {
                    startGachaAudioSequenceInternal();
                }
            } catch (error) {
                console.log('音效系统初始化失败:', error);
            }
        }

        function startGachaAudioSequenceInternal() {
            gachaAudioActive = true;
            console.log('抽球音效序列开始');
            
            // 获取HTML audio元素
            const cheerAudio = document.getElementById('gacha-cheer-audio');
            
            // 创建鼓点音频素材（保留Web Audio API合成的鼓点）
            const drumBuffer = createDrumBeat();
            console.log('鼓点音频缓冲区创建完成', drumBuffer);
            
            // 创建增益节点用于鼓点音量控制
            drumGain = audioContext.createGain();
            drumGain.connect(audioContext.destination);
            console.log('鼓点音频节点连接完成');
            
            // 开始鼓点节拍序列
            console.log('开始鼓点序列');
            startDrumPattern(drumBuffer);
            
            // 2秒后开始播放真实的欢呼声音效
            setTimeout(() => {
                if (gachaAudioActive) {
                    console.log('准备播放真实欢呼声音效');
                    playRealCheerSound(cheerAudio);
                }
            }, 4000);
            
            // 3秒后开始鼓点淡出
            setTimeout(() => {
                if (gachaAudioActive) {
                    console.log('鼓点开始淡出');
                    fadeOutDrums();
                }
            }, 3000);
            
            // 8秒后完全停止
            setTimeout(() => {
                console.log('音效序列结束');
                stopGachaAudio();
            }, 8000);
        }

        // 播放鼓点节拍模式
        function startDrumPattern(drumBuffer) {
            if (!gachaAudioActive) return;
            
            // 更激烈的游戏风格节拍模式
            const beatPattern = [
                1.0, 0.3, 0.6, 0.4,  // 强-弱-中-弱
                0.8, 0.3, 0.7, 0.4,  // 中强-弱-中-弱
                1.0, 0.4, 0.8, 0.3,  // 强-弱-中强-弱
                0.9, 0.3, 0.5, 0.6   // 中强-弱-弱中-中
            ];
            let beatIndex = 0;
            let measureCount = 0;
            
            function playBeat() {
                if (!gachaAudioActive) return;
                
                const source = audioContext.createBufferSource();
                source.buffer = drumBuffer;
                source.connect(drumGain);
                
                // 设置音量根据节拍模式，并随着小节增加强度
                const intensityMultiplier = Math.min(1.2, 1 + measureCount * 0.1);
                drumGain.gain.value = beatPattern[beatIndex] * 0.75 * intensityMultiplier;
                
                source.start();
                
                beatIndex = (beatIndex + 1) % beatPattern.length;
                
                // 每完成一个循环算一个小节
                if (beatIndex === 0) {
                    measureCount++;
                }
                
                // 每180ms一个节拍（约333 BPM，更快更激烈）
                setTimeout(playBeat, 180);
            }
            
            // 设置初始音量
            drumGain.gain.value = 0.75;
            playBeat();
        }

        // 播放欢呼声序列
        function startCheerSequence(cheerBuffer) {
            if (!gachaAudioActive) return;
            
            const source = audioContext.createBufferSource();
            source.buffer = cheerBuffer;
            source.connect(cheerSoundGain);
            
            // 确保初始音量为0，然后渐入
            cheerSoundGain.gain.setValueAtTime(0, audioContext.currentTime);
            cheerSoundGain.gain.linearRampToValueAtTime(0.8, audioContext.currentTime + 1.0); // 1秒渐入到较高音量
            
            console.log('开始播放欢呼声'); // 调试信息
            source.start(audioContext.currentTime);
        }

        // 播放真实的欢呼声音效文件
        function playRealCheerSound(cheerAudio) {
            if (!gachaAudioActive || !cheerAudio) return;
            
            try {
                // 重置音频到开始位置
                cheerAudio.currentTime = 0;
                
                // 设置音量并渐入
                cheerAudio.volume = 0;
                
                // 开始播放
                const playPromise = cheerAudio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('真实欢呼声开始播放');
                        
                        // 1秒内渐入到70%音量
                        const fadeInInterval = setInterval(() => {
                            if (cheerAudio.volume < 0.7) {
                                cheerAudio.volume = Math.min(0.7, cheerAudio.volume + 0.05);
                            } else {
                                clearInterval(fadeInInterval);
                            }
                        }, 50);
                        
                    }).catch(error => {
                        console.log('欢呼声播放失败:', error);
                    });
                }
            } catch (error) {
                console.log('欢呼声播放异常:', error);
            }
        }

        // 鼓点淡出
        function fadeOutDrums() {
            if (drumGain && gachaAudioActive) {
                drumGain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 2);
            }
        }

        // 停止抽球音效
        function stopGachaAudio() {
            gachaAudioActive = false;
            
            // 停止Web Audio合成音频
            if (drumGain) {
                drumGain.gain.setValueAtTime(0, audioContext.currentTime);
            }
            if (cheerSoundGain) {
                cheerSoundGain.gain.setValueAtTime(0, audioContext.currentTime);
            }
            
            // 停止真实欢呼声音频文件
            const cheerAudio = document.getElementById('gacha-cheer-audio');
            if (cheerAudio && !cheerAudio.paused) {
                cheerAudio.pause();
                cheerAudio.currentTime = 0;
            }
        }

        // 抽卡动画系统
        let gachaAnimationActive = false;
        let animationResults = [];
        let animationPoolName = '';
        
        // 动画进度控制
        let animationStartTime = 0;
        let animationDuration = 8000; // 8秒总时长
        let progressInterval = null;
        let animationTimeouts = []; // 存储所有的setTimeout ID

        // 启动抽卡动画
        function startGachaAnimation(times, poolName) {
            if (gachaAnimationActive) return;
            
            gachaAnimationActive = true;
            animationPoolName = poolName;
            
            // 清空之前的动画状态
            clearAnimationTimeouts();
            
            // 暂停背景音乐
            pauseBGMForGacha();
            
            // 先计算抽卡结果
            animationResults = calculateGachaResults(times, poolName);
            
            // 显示动画覆盖层
            const overlay = document.getElementById('gacha-animation');
            overlay.style.display = 'block';
            
            // 重置跳过按钮和进度条
            resetAnimationUI();
            
            // 启动进度条
            startProgressBar();
            
            // 启动抽球音效序列
            startGachaAudioSequence();
            
            // 开始动画序列 - 放慢节奏，增加沉浸感
            animationTimeouts.push(setTimeout(() => startStadiumAnimation(), 200));      // 0.2s: 体育场入场
            animationTimeouts.push(setTimeout(() => showAtmosphereEffects(), 1200));     // 1.2s: 增加氛围效果
            animationTimeouts.push(setTimeout(() => showLightEffects(), 2000));          // 2.0s: 灯光效果
            animationTimeouts.push(setTimeout(() => showCameraMovement(), 3000));        // 3.0s: 相机运镜
            animationTimeouts.push(setTimeout(() => showRarityEffects(), 4500));         // 4.5s: 稀有度效果 (分歧点)
            animationTimeouts.push(setTimeout(() => showResultCard(), 6500));            // 6.5s: 显示结果卡片
            animationTimeouts.push(setTimeout(() => endAnimation(), 8000));              // 8.0s: 结束动画
        }

        // 启动保底动画
        function startGachaAnimationWithPity(times) {
            // 暂停背景音乐
            pauseBGMForGacha();
            
            // 处理保底逻辑
            const guaranteedCount = 10 + Math.floor(Math.random() * 3);
            const results = [];
            
            // 保底精选球员
            for (let i = 0; i < guaranteedCount; i++) {
                const player = getPlayerByRarity('精选');
                if (player) {
                    const isNew = !playerInventory.some(p => p.姓名 === player.姓名);
                    if (isNew) {
                        playerInventory.push({...player, 获得时间: new Date().toISOString()});
                    }
                    results.push({player, isNew, isPity: true});
                }
            }
            
            // 剩余普通抽卡
            const remainingTimes = times - guaranteedCount;
            for (let i = 0; i < remainingTimes; i++) {
                const rarity = getRandomRarity();
                const player = getPlayerByRarity(rarity);
                if (player) {
                    const isNew = !playerInventory.some(p => p.姓名 === player.姓名);
                    if (isNew) {
                        playerInventory.push({...player, 获得时间: new Date().toISOString()});
                    }
                    results.push({player, isNew});
                }
            }

            // 重置保底计数器
            featuredGachaCounter = 0;
            guaranteedFeaturedCount += guaranteedCount;
            
            // 设置动画结果并启动动画
            animationResults = results;
            animationPoolName = `精选卷池 - 保底触发！获得${guaranteedCount}个精选球员`;
            
            // 启动动画（不再调用startGachaAnimation，直接执行动画逻辑）
            if (gachaAnimationActive) return;
            
            gachaAnimationActive = true;
            
            // 清空之前的动画状态
            clearAnimationTimeouts();
            
            // 显示动画覆盖层
            const overlay = document.getElementById('gacha-animation');
            overlay.style.display = 'block';
            
            // 重置跳过按钮和进度条
            resetAnimationUI();
            
            // 启动进度条
            startProgressBar();
            
            // 启动抽球音效序列
            startGachaAudioSequence();
            
            // 开始动画序列 - 保底动画也使用新时间线
            animationTimeouts.push(setTimeout(() => startStadiumAnimation(), 200));      // 0.2s: 体育场入场
            animationTimeouts.push(setTimeout(() => showAtmosphereEffects(), 1200));     // 1.2s: 增加氛围效果
            animationTimeouts.push(setTimeout(() => showLightEffects(), 2000));          // 2.0s: 灯光效果
            animationTimeouts.push(setTimeout(() => showCameraMovement(), 3000));        // 3.0s: 相机运镜
            animationTimeouts.push(setTimeout(() => showRarityEffects(), 4500));         // 4.5s: 稀有度效果 (分歧点)
            animationTimeouts.push(setTimeout(() => showResultCard(), 6500));            // 6.5s: 显示结果卡片
            animationTimeouts.push(setTimeout(() => endAnimation(), 8000));              // 8.0s: 结束动画
        }

        // 计算抽卡结果
        function calculateGachaResults(times, poolName) {
            const results = [];
            
            for (let i = 0; i < times; i++) {
                let targetRarity = null;
                
                if (poolName === '高光定向卷池') {
                    const random = Math.random();
                    if (random < 0.001) {
                        targetRarity = '传奇高光';
                    } else if (random < 0.01) {
                        targetRarity = '高光';
                    }
                } else if (poolName === '精选定向卷池') {
                    if (Math.random() < 0.01) {
                        targetRarity = '精选';
                    }
                } else if (poolName === '高光卷池') {
                    const random = Math.random();
                    if (random < 0.01) {
                        targetRarity = '传奇高光';
                    } else if (random < 0.10) {
                        targetRarity = '高光';
                    }
                } else if (poolName === '精选卷池') {
                    if (Math.random() < 0.04) {
                        targetRarity = '精选';
                    }
                }
                
                if (!targetRarity) {
                    targetRarity = getRandomRarity();
                }
                
                const player = getPlayerByRarity(targetRarity);
                if (player) {
                    const isNew = !playerInventory.some(p => p.姓名 === player.姓名);
                    if (isNew) {
                        playerInventory.push({...player, 获得时间: new Date().toISOString()});
                    }
                    results.push({player, isNew});
                }
            }
            
            return results;
        }

        // 开始体育场动画
        function startStadiumAnimation() {
            // 缓慢创建初始粒子效果
            createParticles();
            
            // 添加体育场慢慢显现的效果
            const stadium = document.getElementById('stadium-animation');
            stadium.style.animation = 'stadiumZoom 3s ease-out forwards';
            
            // 延迟添加初始音效（如果有的话）
            setTimeout(() => {
                // 这里可以添加体育场入场音效
                console.log('体育场动画开始 - 进场阶段');
            }, 500);
        }

        // 显示灯光效果
        function showLightEffects() {
            const lightsContainer = document.getElementById('stadium-lights');
            const bestRarity = getBestRarity(animationResults);
            const rarityCount = getRarityCount(animationResults);
            
            // 判断是否为银河特效
            const isGalaxy = rarityCount >= 2;
            const rarityClass = isGalaxy ? 'rarity-galaxy' : getRarityClass(bestRarity);
            
            // 创建灯带 - 更华丽的缓慢序列
            const positions = ['top', 'right', 'bottom', 'left'];
            positions.forEach((pos, index) => {
                setTimeout(() => {
                    const lightStrip = document.createElement('div');
                    lightStrip.className = `light-strip ${pos} ${rarityClass}`;
                    lightsContainer.appendChild(lightStrip);
                    
                    // 添加额外的光环效果 - 延长时间
                    if (isGalaxy || bestRarity === '传奇高光') {
                        setTimeout(() => createEnergyRing(rarityClass), 400);
                    }
                }, index * 300); // 从150ms改为300ms，更缓慢
            });
            
            // LED 像素效果 - 延后触发
            setTimeout(() => showLEDEffect(rarityClass), 1200); // 从600ms改为1200ms
            
            // 激光束效果（高稀有度）- 延后触发
            if (bestRarity === '高光' || bestRarity === '传奇高光' || isGalaxy) {
                setTimeout(() => createLaserBeams(rarityClass), 1600); // 从800ms改为1600ms
            }
        }

        // 增加氛围效果 - 新增功能
        function showAtmosphereEffects() {
            const stadium = document.getElementById('stadium-animation');
            
            // 添加轻微的体育场震动效果
            stadium.style.animation = 'stadiumVibration 2s ease-in-out';
            
            // 创建观众欢呼的粒子效果
            createCheerParticles();
            
            // 添加环境光效果
            createAmbientLighting();
        }

        // 相机运镜效果 - 新增功能
        function showCameraMovement() {
            const stadium = document.getElementById('stadium-animation');
            
            // 添加相机缓慢推进效果
            stadium.style.animation = 'cameraZoomIn 1.5s ease-out forwards';
            
            // 创建景深效果
            createDepthOfField();
        }

        // 显示稀有度特效
        function showRarityEffects() {
            const bestRarity = getBestRarity(animationResults);
            const rarityCount = getRarityCount(animationResults);
            
            // 烟花特效
            if (rarityCount >= 2 || bestRarity === '传奇高光') {
                createSuperFireworks();
            } else if (bestRarity === '高光' || bestRarity === '精选') {
                createFireworks();
            }
            
            // 超级特效
            if (rarityCount >= 3 || bestRarity === '传奇高光') {
                createMegaEffect();
            }
        }

        // 显示结果卡片
        function showResultCard() {
            const showcase = document.getElementById('result-showcase');
            const bestPlayer = getBestPlayer(animationResults);
            
            if (bestPlayer) {
                const cardHtml = createPlayerCard(bestPlayer.player);
                const cardElement = document.createElement('div');
                cardElement.innerHTML = cardHtml;
                const card = cardElement.firstChild;
                card.classList.add('best-player-card');
                
                // 添加缓慢入场效果
                card.style.transform = 'scale(0.3) rotateY(90deg)';
                card.style.opacity = '0';
                card.style.transition = 'all 1.5s cubic-bezier(0.34, 1.56, 0.64, 1)';
                
                showcase.appendChild(card);
                
                // 延迟显示卡片
                setTimeout(() => {
                    card.style.transform = 'scale(1) rotateY(0deg)';
                    card.style.opacity = '1';
                }, 100);
                
                // 添加卡片光环效果
                setTimeout(() => {
                    card.style.boxShadow = '0 0 50px rgba(255, 215, 0, 0.6), 0 0 100px rgba(255, 215, 0, 0.3)';
                }, 800);
            }
        }

        // 结束动画
        function endAnimation() {
            // 清理动画状态
            clearAnimationTimeouts();
            
            setTimeout(() => {
                const overlay = document.getElementById('gacha-animation');
                overlay.style.display = 'none';
                
                // 显示正常的抽卡结果
                displayGachaResults(animationResults, animationPoolName);
                updateCurrencyDisplay();
                updateInventoryCount();
                updatePityCounter();
                
                // 清理动画元素
                cleanupAnimation();
                gachaAnimationActive = false;
                
                // 恢复背景音乐（播放新的随机音乐）
                resumeBGMAfterGacha();
            }, 1000);
        }

        // 进度条控制函数
        function startProgressBar() {
            animationStartTime = Date.now();
            const progressBar = document.getElementById('animation-progress-bar');
            const progressGlow = document.getElementById('animation-progress-glow');
            
            // 显示光晕效果
            progressGlow.style.opacity = '1';
            
            // 启动进度更新循环
            progressInterval = setInterval(() => {
                const elapsed = Date.now() - animationStartTime;
                const progress = Math.min((elapsed / animationDuration) * 100, 100);
                
                progressBar.style.width = progress + '%';
                progressGlow.style.left = (progress - 2) + '%'; // 光晕稍微偏左
                
                // 根据进度改变进度条颜色和阶段
                updateProgressBarStage(progressBar, progress);
                
                // 当进度超过25%时自动显示跳过按钮
                if (progress >= 25) {
                    showSkipButton();
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
            }, 50); // 每50ms更新一次
        }

        function updateProgressBarStage(progressBar, progress) {
            // 清除所有阶段类
            progressBar.className = 'animation-progress-bar';
            
            if (progress >= 81.25) { // 6.5s/8s = 81.25% (结果显示)
                progressBar.classList.add('stage-result');
            } else if (progress >= 56.25) { // 4.5s/8s = 56.25% (稀有度效果)
                progressBar.classList.add('stage-rarity');
            } else if (progress >= 37.5) { // 3.0s/8s = 37.5% (相机运镜)
                progressBar.classList.add('stage-camera');
            } else if (progress >= 25) { // 2.0s/8s = 25% (灯光效果)
                progressBar.classList.add('stage-lights');
            } else if (progress >= 15) { // 1.2s/8s = 15% (氛围效果)
                progressBar.classList.add('stage-atmosphere');
            }
            // 默认阶段保持原来的蓝色
        }

        function resetAnimationUI() {
            // 重置跳过按钮
            const skipButton = document.getElementById('skip-button');
            skipButton.style.opacity = '0';
            skipButton.style.transform = 'translateY(50px)';
            
            // 重置进度条
            const progressBar = document.getElementById('animation-progress-bar');
            const progressGlow = document.getElementById('animation-progress-glow');
            progressBar.style.width = '0%';
            progressGlow.style.opacity = '0';
            progressGlow.style.left = '0%';
        }

        function clearAnimationTimeouts() {
            // 清除所有的setTimeout
            animationTimeouts.forEach(timeoutId => {
                clearTimeout(timeoutId);
            });
            animationTimeouts = [];
            
            // 停止进度条
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
            
            // 停止抽球音效
            stopGachaAudio();
        }

        // 跳过动画
        function skipGachaAnimation() {
            if (!gachaAnimationActive) return;
            
            // 清除所有未完成的动画
            clearAnimationTimeouts();
            
            // 立即恢复音乐
            resumeBGMAfterGacha();
            
            // 立即结束动画
            endAnimation();
        }

        // 显示跳过按钮
        function showSkipButton() {
            if (!gachaAnimationActive) return;
            
            const skipButton = document.getElementById('skip-button');
            
            // 防止重复触发动画
            if (skipButton.style.opacity !== '0' && skipButton.style.opacity !== '') {
                return;
            }
            
            skipButton.style.animation = 'skipButtonAppear 0.5s ease-out forwards';
        }

        // 获取最佳稀有度
        function getBestRarity(results) {
            const rarityOrder = ['普卡', '梦幻精选', '精选', '高光', '传奇高光'];
            let bestRarity = '普卡';
            
            results.forEach(result => {
                const currentIndex = rarityOrder.indexOf(result.player.稀有度);
                const bestIndex = rarityOrder.indexOf(bestRarity);
                if (currentIndex > bestIndex) {
                    bestRarity = result.player.稀有度;
                }
            });
            
            return bestRarity;
        }

        // 获取特色卡数量
        function getRarityCount(results) {
            return results.filter(result => 
                ['精选', '高光', '传奇高光'].includes(result.player.稀有度)
            ).length;
        }

        // 获取最佳球员
        function getBestPlayer(results) {
            const rarityOrder = ['普卡', '梦幻精选', '精选', '高光', '传奇高光'];
            let bestPlayer = results[0];
            
            results.forEach(result => {
                const currentIndex = rarityOrder.indexOf(result.player.稀有度);
                const bestIndex = rarityOrder.indexOf(bestPlayer.player.稀有度);
                if (currentIndex > bestIndex) {
                    bestPlayer = result;
                }
            });
            
            return bestPlayer;
        }

        // 获取稀有度样式类
        function getRarityClass(rarity) {
            const rarityClasses = {
                '普卡': 'rarity-normal',
                '梦幻精选': 'rarity-dream',
                '精选': 'rarity-featured',
                '高光': 'rarity-highlight',
                '传奇高光': 'rarity-legend'
            };
            return rarityClasses[rarity] || 'rarity-normal';
        }

        // 创建粒子效果
        function createParticles() {
            const container = document.querySelector('.stadium-container');
            
            // 增加粒子数量并延长创建时间
            for (let i = 0; i < 80; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 4 + 's'; // 延长动画延迟
                    particle.style.animationDuration = (2 + Math.random() * 3) + 's'; // 随机动画时长
                    container.appendChild(particle);
                    
                    // 5秒后移除粒子 - 延长生命周期
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 5000);
                }, i * 80); // 从50ms改为80ms，更缓慢创建
            }
        }

        // 创建欢呼粒子效果 - 新增功能
        function createCheerParticles() {
            const container = document.querySelector('.stadium-container');
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'cheer-particle';
                    particle.style.cssText = `
                        position: absolute;
                        width: 6px;
                        height: 6px;
                        background: radial-gradient(circle, #ffeb3b, #ff9800);
                        border-radius: 50%;
                        left: ${Math.random() * 100}%;
                        top: 60%;
                        animation: cheerParticle 2s ease-out forwards;
                        --random-x: ${(Math.random() - 0.5) * 100}px;
                        box-shadow: 0 0 6px rgba(255, 235, 59, 0.8);
                        z-index: 5;
                    `;
                    container.appendChild(particle);
                    
                    // 2秒后移除粒子
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 2000);
                }, i * 60);
            }
        }

        // 创建环境光效果 - 新增功能
        function createAmbientLighting() {
            const container = document.querySelector('.stadium-container');
            
            const ambientLight = document.createElement('div');
            ambientLight.className = 'ambient-light';
            ambientLight.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(ellipse 80% 60% at 50% 40%, 
                    rgba(255, 255, 255, 0.1) 0%, 
                    rgba(135, 206, 250, 0.05) 30%, 
                    transparent 70%);
                animation: ambientPulse 3s ease-in-out infinite;
                pointer-events: none;
                z-index: 1;
            `;
            container.appendChild(ambientLight);
            
            // 5秒后移除环境光
            setTimeout(() => {
                if (ambientLight.parentNode) {
                    ambientLight.parentNode.removeChild(ambientLight);
                }
            }, 5000);
        }

        // 创建景深效果 - 新增功能
        function createDepthOfField() {
            const stadium = document.getElementById('stadium-animation');
            
            // 添加景深模糊边缘
            const depthOverlay = document.createElement('div');
            depthOverlay.className = 'depth-overlay';
            depthOverlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(ellipse 60% 50% at 50% 50%, 
                    transparent 30%, 
                    rgba(0, 0, 0, 0.1) 70%, 
                    rgba(0, 0, 0, 0.3) 100%);
                pointer-events: none;
                z-index: 3;
                opacity: 0;
                transition: opacity 1.5s ease-out;
            `;
            stadium.appendChild(depthOverlay);
            
            // 渐显景深效果
            setTimeout(() => {
                depthOverlay.style.opacity = '1';
            }, 100);
            
            // 3秒后移除景深效果
            setTimeout(() => {
                if (depthOverlay.parentNode) {
                    depthOverlay.parentNode.removeChild(depthOverlay);
                }
            }, 3000);
        }

        // 显示LED效果
        function showLEDEffect(rarityClass) {
            const ledContainer = document.getElementById('stadium-led');
            
            for (let i = 0; i < 200; i++) {
                setTimeout(() => {
                    const ledPixel = document.createElement('div');
                    ledPixel.className = `led-pixel ${rarityClass}`;
                    ledPixel.style.left = Math.random() * 100 + '%';
                    ledPixel.style.top = Math.random() * 100 + '%';
                    ledPixel.style.animationDelay = Math.random() * 1 + 's';
                    ledContainer.appendChild(ledPixel);
                }, i * 10);
            }
        }

        // 创建超级烟花效果
        function createSuperFireworks() {
            const fireworksContainer = document.getElementById('fireworks');
            const colors = ['#ff1493', '#ffd700', '#00bfff', '#ff8c00', '#8a2be2', '#ff6b6b', '#00ff80'];
            
            // 多层烟花爆炸
            for (let layer = 0; layer < 3; layer++) {
                setTimeout(() => {
                    for (let i = 0; i < 30; i++) {
                        setTimeout(() => {
                            const firework = document.createElement('div');
                            firework.className = 'firework';
                            firework.style.left = Math.random() * 100 + '%';
                            firework.style.top = Math.random() * 60 + '%';
                            firework.style.background = colors[Math.floor(Math.random() * colors.length)];
                            firework.style.animationDelay = Math.random() * 0.5 + 's';
                            firework.style.animationDuration = (1.5 + Math.random()) + 's';
                            fireworksContainer.appendChild(firework);
                            
                            // 2秒后移除烟花
                            setTimeout(() => {
                                if (firework.parentNode) {
                                    firework.parentNode.removeChild(firework);
                                }
                            }, 2500);
                        }, i * 50);
                    }
                }, layer * 800);
            }
        }

        // 创建普通烟花效果
        function createFireworks() {
            const fireworksContainer = document.getElementById('fireworks');
            const colors = ['#ff6b6b', '#ffd700', '#00bfff', '#ff8c00', '#8a2be2'];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 50 + '%';
                    firework.style.background = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.animationDelay = Math.random() * 0.5 + 's';
                    fireworksContainer.appendChild(firework);
                    
                    setTimeout(() => {
                        if (firework.parentNode) {
                            firework.parentNode.removeChild(firework);
                        }
                    }, 2000);
                }, i * 100);
            }
        }

        // 创建激光束效果
        function createLaserBeams(rarityClass) {
            const laserContainer = document.getElementById('laser-container');
            
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const laser = document.createElement('div');
                    laser.className = `laser-beam ${rarityClass}`;
                    laser.style.left = Math.random() * 100 + '%';
                    laser.style.animationDelay = Math.random() * 2 + 's';
                    laserContainer.appendChild(laser);
                    
                    setTimeout(() => {
                        if (laser.parentNode) {
                            laser.parentNode.removeChild(laser);
                        }
                    }, 3000);
                }, i * 200);
            }
        }

        // 创建能量环效果
        function createEnergyRing(rarityClass) {
            const energyContainer = document.getElementById('energy-container');
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const ring = document.createElement('div');
                    ring.className = `energy-ring ${rarityClass}`;
                    ring.style.animationDelay = i * 0.3 + 's';
                    energyContainer.appendChild(ring);
                    
                    setTimeout(() => {
                        if (ring.parentNode) {
                            ring.parentNode.removeChild(ring);
                        }
                    }, 2000);
                }, i * 400);
            }
        }

        // 创建超级特效
        function createMegaEffect() {
            // 屏幕震动效果
            const overlay = document.getElementById('gacha-animation');
            overlay.style.animation = 'screenShake 0.5s ease-in-out 3';
            
            // 创建超级粒子
            createSuperParticles();
            
            // 全屏闪光
            createScreenFlash();
        }

        // 创建超级粒子
        function createSuperParticles() {
            const container = document.querySelector('.stadium-container');
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.background = `hsl(${Math.random() * 360}, 100%, 70%)`;
                    particle.style.animationDelay = Math.random() * 2 + 's';
                    particle.style.animationDuration = (2 + Math.random() * 2) + 's';
                    container.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 4000);
                }, i * 30);
            }
        }

        // 创建全屏闪光
        function createScreenFlash() {
            const flash = document.createElement('div');
            flash.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
                z-index: 9998;
                pointer-events: none;
                animation: screenFlash 0.5s ease-out forwards;
            `;
            
            document.body.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) {
                    flash.parentNode.removeChild(flash);
                }
            }, 500);
        }

        // 清理动画元素
        function cleanupAnimation() {
            // 清理灯光
            const lightsContainer = document.getElementById('stadium-lights');
            lightsContainer.innerHTML = '';
            
            // 清理LED
            const ledContainer = document.getElementById('stadium-led');
            ledContainer.innerHTML = '';
            
            // 清理烟花
            const fireworksContainer = document.getElementById('fireworks');
            fireworksContainer.innerHTML = '';
            
            // 清理激光
            const laserContainer = document.getElementById('laser-container');
            laserContainer.innerHTML = '';
            
            // 清理能量环
            const energyContainer = document.getElementById('energy-container');
            energyContainer.innerHTML = '';
            
            // 清理展示区
            const showcase = document.getElementById('result-showcase');
            showcase.innerHTML = '';
            
            // 清理粒子
            const particles = document.querySelectorAll('.particle');
            particles.forEach(particle => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            });
        }
    </script>
</body>
</html>
